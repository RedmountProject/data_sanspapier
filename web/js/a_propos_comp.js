var fillLoginForm=function(a){$("#form").html(a);$("#form").append('<div><span id="forgotPasswordForm">mot-de-passe oublié ?</span></div>');$("#form").append('<div><span id="registerForm">créer un compte</span></div>');$("#registerForm").click(function(){AjaxController.getRegisterForm(fillRegisterForm)});$("#forgotPasswordForm").click(function(){AjaxController.getPasswordResetterForm(fillForgotPasswordForm)})};var fillRegisterForm=function(a){$("#form").html(a);$("#form").append('<div><span id="loginForm">Retour</span></div>');$("#loginForm").click(function(){AjaxController.getLoginForm(fillLoginForm)})};var fillForgotPasswordForm=function(a){$("#form").html(a);$("#form").append('<div><span id="loginForm">Retour</span></div>');$("#loginForm").click(function(){AjaxController.getLoginForm(fillLoginForm)})};var connected=function(a){$("#form").html(a);$("#logout").click(function(){AjaxController.logOut();$("#form").html('<p style="font-size:16px; font-weight: bold; position:relative; float: right; margin:10px;">Déconnecté</p>')});$("#perso").click(function(){window.location=window.sanspapier.config.front_url+"profile.html"})};var bindClickHandlers=function(){$("#loginForm").click(function(){AjaxController.getLoginForm(fillLoginForm)});$("#registerForm").click(function(){AjaxController.getRegisterForm(fillRegisterForm)});$("#forgotPasswordForm").click(function(){AjaxController.getPasswordResetterForm(fillForgotPasswordForm)})};var hideHandlers=function(){$("#loginForm").hide();$("#registerForm").hide();$("#forgotPasswordForm").hide()};var showHandlers=function(){$("#loginForm").show();$("#registerForm").show();$("#forgotPasswordForm").show()};var userForm=function(){$("#mon_compte").click(function(){AjaxController.is_logged()});$("#mon_compte").qtip({content:{text:$("#form")},show:{event:"click"},hide:{fixed:true,event:"unfocus",delay:600},position:{at:"bottom right",my:"top right",adjust:{}},style:{classes:"windows",tip:{corner:false}},events:{show:function(b,a){$.fn.qtip.zindex=1000}}})};
window.onload=function(){userForm();context();cart_tooltip();refreshCart()};
function createCartResults(a){var e=window.sanspapier.config;var f="";if(a.author_firstname!==undefined){f=a.author_firstname[0]+" "}else{f=""}var d=a.EUR_c.slice(0,4);var b="#!booksheet|"+fixedEncodeURIComponent(a.product_id);var c='<div class="cart_container">\n                            <div class="cartElement_container" id="cart_'+a.product_id+'">\n                                <a href="'+b+'" class="cartElement_image bookSheetIdLink" id="cartBooksheet_'+a.product_id+'" title="Obtenir plus d\'infos sur ce livre"><img tooltip="'+a.product_id+'" src="'+e.images_url+a.product_id+"/"+a.product_id+'_fc_E.jpg"/></a>\n                                <a href="'+b+'" class="cartElement_title bookSheetIdLink" id="linkTitleBiblio_'+a.product_id+'" tooltip="'+a.product_id+'">'+a.title+'</a>\n                                <div class="cartElement_author">'+f+a.author_lastname[0]+'</div>\n                                <div class="cartElement_publisher">'+a.publisher_name+'</div>\n                                <div class="cartElement_price">'+d+' €</div>\n                                <a href="#'+a.product_id+'" class="delete_cartElement" id="#cart_'+a.product_id+'"><img src="http://grammezero.com/images/icons/delete.png" /></a>\n                            </div>\n                        </div>';return c}function fillCartDom(a){$("#panier_display").html(a)};
var AjaxController=(function(){var b=window.sanspapier.config.data_url;var a={logOut:function(){var c=b+"profile/ajax_logout.json";$.ajax({url:c,dataType:"json",complete:function(){},success:function(){console.log("logout")},error:function(){console.log("logout error")}})},is_logged:function(){var c=b+"profile/ajax_is_logged.json";$.ajax({url:c,dataType:"json",complete:function(){},success:function(d){if(d.status==false){console.log("not connected");AjaxController.getLoginForm(fillLoginForm)}else{if(d.status==true){console.log("connected");AjaxController.connected(connected);$("#forgotPasswordForm").hide();$("#registerForm").hide()}}},error:function(){}})},connected:function(d){var c=b+"profile/ajax_is_logged.json";$.ajax({url:c,dataType:"json",complete:function(){},success:function(e){var f="";if(e.pref["firstname"]==undefined&&e.pref["lastname"]==undefined){f=e.user}else{f=e.pref["firstname"]+" "+e.pref["lastname"]}d('<div id="user_name">Bonjour '+f+'</div><span id="perso">Accéder à l\'espace perso</span><br><span id="logout">Se déconnecter</span>')},error:function(){}})},getLoginForm:function(d){var c=b+"login";$.ajax({url:c,dataType:"html",complete:function(){},success:function(e){d(e)},error:function(){console.log("login form ajax_error")}})},getRegisterForm:function(d){var c=b+"register";$.ajax({url:c,dataType:"html",complete:function(){},success:function(e){d(e)},error:function(){console.log("register form ajax_error")}})},getPasswordResetterForm:function(d){var c=b+"resetting/request";$.ajax({url:c,dataType:"html",complete:function(){},success:function(e){d(e)},error:function(){console.log("password resetter ajax_error")}})},removeElementFromCart:function(c,h){var d=window.sanspapier.config.front_url;var e=b+"profile/cart/delete_from_cart_"+c+".json";var i="";var g="";var f=h;$.ajax({url:e,dataType:"json",complete:function(){},success:function(j){$.ajax({url:b+"profile/cart/get_cart.json",dataType:"json",complete:function(){},success:function(l){if(l.status==true){for(var k=0;k<l.data["products"].length;k++){g=g+createCartResults(l.data["products"][k])}i=g+'<div class="total_price">Total: '+l.data["total_price"]+'€</div><a href="'+d+'shop.html" class="endCart" id="processCart"><img src="http://grammezero.com/images/icons/finish.png" /></a>';fillCartDom(i);h.set("content.text",$("#panier_display"));$("#cart").qtip("render")}else{i="panier vide";fillCartDom(i);h.set("content.text",$("#panier_display"));$("#cart").qtip("render")}deleteElementFromCart(h)},error:function(){console.log("ajax_error")}});if(j.status==true){animateCart(j.numOfItems)}},error:function(){console.log("ajax_error")}})}};return a})();
var booksheet_tooltip=function(){var a=$(".bookSheetIdLink").each(function(){$(this).click(function(){updatePage()})});var b=$("#booksheet .buy_button").each(function(){});$(document.body).qtip({content:{text:$("#modal_loading").clone()},position:{target:$(window),my:"center",at:"center"},show:{target:a,event:"click",modal:{on:true,blur:true}},hide:{target:b,event:"click"},style:{classes:"windows"},events:{show:function(d,c){update_bookSheet_targets();$.fn.qtip.zindex=15000;c.set("content.text",$("#modal_loading").clone());$("body").css("overflow","hidden")},hide:function(d,c){$("body").css("overflow","visible")}}})};var update_bookSheet_targets=function(){var a=$(".bookSheetIdLink").each(function(){});$(document.body).qtip("option","show.target",a);$(document.body).qtip("render")};var update_booksheet_close_target=function(){var a=$("#booksheet .buy_button").each(function(){});$(document.body).qtip("option","hide.target",a);$(document.body).qtip("render")};var cart_tooltip=function(){var b=window.sanspapier.config.data_url;var a=window.sanspapier.config.front_url;var c="";$("#cart").qtip({content:{text:"Chargement...",ajax:{url:b+"profile/cart/get_cart.json",type:"GET",dataType:"json",once:false,complete:function(){deleteElementFromCart(this)},success:function(f){console.log(f);var e="";if(f.status==true){for(var d=0;d<f.data["products"].length;d++){c+=createCartResults(f.data["products"][d])}e=c+'<div class="total_price">Total: '+f.data["total_price"]+' €</div><a href="'+a+'shop.html" class="endCart" id="processCart"><img src="http://grammezero.com/images/icons/finish.png" /></a>';fillCartDom(e);this.set("content.text",$("#panier_display"));$("#cart").qtip("render")}else{e="panier vide";fillCartDom(e);this.set("content.text",$("#panier_display"));$("#cart").qtip("render")}c=""},error:function(){console.log("ajax error")}}},show:{event:"click"},hide:{event:"mouseleave",fixed:true,delay:400},position:{target:$("#cart"),at:"bottom right",my:"top right",adjust:{x:18}},style:{classes:"windows",tip:{corner:false}},events:{show:function(f,d){$.fn.qtip.zindex=20000}}})};var deleteElementFromCart=function(b){var a=b;$(".delete_cartElement").each(function(){var c=($(this).attr("id")).split("_")[1];$.attr(this,"tooltip",c);$(this).click(function(){$("#cart_"+c).animate({height:"0px",opacity:0},100,function(){AjaxController.removeElementFromCart(c,b)})})})};var animateCart=function(a){$("#cart").animate({opacity:0},50,function(){$("#cart").animate({opacity:0.7},100)});$("#cartCount").animate({opacity:0},50,function(){$("#cartCount").animate({opacity:1},100)});if(a==0){$("#cartCount").html("")}else{$("#cartCount").html("("+a+")")}};var refreshCart=function(){var a=window.sanspapier.config.data_url;$.ajax({url:a+"profile/cart/count_cart.json",dataType:"json",complete:function(){},success:function(b){if(b==0){$("#cartCount").html("")}else{$("#cartCount").html("("+b+")")}},error:function(){console.log("ajax_error")}})};var moreText=function(){$(".text").css({"overflow-y":"scroll"});$(".text").html(window.sanspapier.booksheet.fullText);addBlank(".text")};